(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const t of n)if(t.type==="childList")for(const r of t.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function a(n){const t={};return n.integrity&&(t.integrity=n.integrity),n.referrerPolicy&&(t.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?t.credentials="include":n.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function s(n){if(n.ep)return;n.ep=!0;const t=a(n);fetch(n.href,t)}})();const d=document.getElementById("status"),u=document.getElementById("debug"),l=document.getElementById("wrap");async function m(){try{const e=await fetch("/config.json",{cache:"no-store"});if(!e.ok)throw new Error("config.json saknas i public/ (kopiera config.example.json)");return await e.json()}catch(e){throw d.textContent="Fel: "+e.message,e}}function c(e){d.textContent=e}function i(e){if(!u)return;const o=new Date().toLocaleTimeString();u.textContent=`[${o}] ${e}
`+u.textContent}function p(e){if(e.view==="cards"){l.innerHTML=e.items.map(o=>`
      <div class="card">
        <h3>${o.title||"Svar"}</h3>
        <p>${o.body||""}</p>
      </div>
    `).join("");return}l.innerHTML=`<div class="card"><h3>Payload</h3><pre>${JSON.stringify(e,null,2)}</pre></div>`}function f(e){const o=e.topicTemplate.replace("{tenant}",e.tenant).replace("{screenId}",e.screenId),a=(e.mqtt.clientIdPrefix||"display-")+Math.random().toString(16).slice(2),s=new Paho.MQTT.Client(e.mqtt.host,Number(e.mqtt.port),e.mqtt.path||"/mqtt",a);s.onConnectionLost=t=>{c("Frånkopplad, försöker igen…"),i("connection lost: "+((t==null?void 0:t.errorMessage)||"okänt")),setTimeout(()=>s.connect(n()),1500)},s.onMessageArrived=t=>{try{const r=JSON.parse(t.payloadString);e.debug&&i("message: "+t.payloadString),p(r)}catch(r){i("parse error: "+r.message)}};function n(){const t={timeout:5,useSSL:!!e.mqtt.useTLS,onSuccess:()=>{c("Ansluten"),s.subscribe(o,{qos:0}),i("subscribed: "+o)},onFailure:r=>{c("Kunde inte ansluta"),i("connect failed: "+((r==null?void 0:r.errorMessage)||""))}};return e.mqtt.username&&(t.userName=e.mqtt.username),e.mqtt.password&&(t.password=e.mqtt.password),t}return c("Ansluter…"),s.connect(n()),{client:s,topic:o}}m().then(e=>{c("Konfiguration laddad"),f(e)}).catch(e=>{console.error(e)});
